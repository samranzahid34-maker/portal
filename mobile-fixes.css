/* Apply these fixes within the existing @media (max-width: 768px) block */

/* ========================================
   TABLE FIXES - Grid-Based Layout
   ======================================== */

/* Override existing .responsive-table td styles */
@media (max-width: 768px) {

    /* ========================================
       GLOBAL VIEWPORT CONSTRAINTS
       ======================================== */

    /* Prevent any element from exceeding viewport */
    * {
        max-width: 100vw !important;
        box-sizing: border-box !important;
    }

    body,
    html {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
    }

    /* Container constraints */
    .container,
    .main-content,
    #main-content,
    .content-wrapper {
        width: 100% !important;
        max-width: 100vw !important;
        padding-left: 1rem !important;
        padding-right: 1rem !important;
        overflow-x: hidden !important;
    }

    /* ========================================
       SIDEBAR & NAVIGATION FIXES
       ======================================== */

    /* Fix oversized close button in sidebar */
    .sidebar .mobile-only button,
    .sidebar-inner .mobile-only button {
        width: 40px !important;
        height: 40px !important;
        padding: 0.5rem !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    .sidebar .mobile-only button svg,
    .sidebar-inner .mobile-only button svg {
        width: 20px !important;
        height: 20px !important;
    }

    /* Ensure hamburger menu is visible */
    .hamburger-btn,
    button.hamburger-btn,
    .navbar .hamburger-btn {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 44px !important;
        height: 44px !important;
        padding: 0.5rem !important;
        background: transparent !important;
        border: none !important;
        cursor: pointer !important;
        color: inherit !important;
    }

    .hamburger-btn svg {
        width: 24px !important;
        height: 24px !important;
        stroke: currentColor !important;
    }

    /* Position navbar items correctly on mobile */
    .navbar {
        justify-content: flex-start !important;
        gap: 1rem !important;
    }

    .navbar>div:first-child {
        margin-right: auto !important;
        order: -1 !important;
    }

    /* Logout button visibility and styling */
    #logout-btn,
    .navbar #logout-btn {
        display: inline-block !important;
        padding: 0.5rem 1rem !important;
        background: #ef4444 !important;
        color: white !important;
        border: none !important;
        border-radius: 0.5rem !important;
        cursor: pointer !important;
        font-size: 0.9rem !important;
        font-weight: 500 !important;
        min-height: 40px !important;
    }

    #logout-btn:hover {
        background: #dc2626 !important;
    }

    /* ========================================
       STUDENT DASHBOARD FIXES
       ======================================== */

    /* Student dashboard header */
    #marks-section #main-content>div:first-child,
    #main-content>div[style*="justify-content: space-between"] {
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        padding: 1rem !important;
        gap: 0.5rem !important;
    }

    /* Student hamburger menu - left aligned */
    #marks-section button[onclick="toggleSidebar()"],
    #main-content button[onclick="toggleSidebar()"] {
        order: -1 !important;
        margin-right: 0 !important;
        flex-shrink: 0 !important;
        width: 40px !important;
        height: 40px !important;
        padding: 0.5rem !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    #marks-section button[onclick="toggleSidebar()"] svg,
    #main-content button[onclick="toggleSidebar()"] svg {
        width: 20px !important;
        height: 20px !important;
    }


    /* Student portal title - center on mobile */
    #marks-section h1,
    #main-content h1[style*="position: absolute"] {
        position: static !important;
        transform: none !important;
        font-size: 1rem !important;
        flex: 1 !important;
        text-align: center !important;
        margin: 0 0.5rem !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
    }

    /* Student logout button - right aligned */
    #marks-section .btn-logout,
    #main-content .btn-logout {
        order: 1 !important;
        flex-shrink: 0 !important;
        padding: 0.5rem 0.75rem !important;
        font-size: 0.85rem !important;
        background: transparent !important;
        color: #1e293b !important;
        border: 1px solid #e2e8f0 !important;
        border-radius: 0.5rem !important;
        min-height: auto !important;
        height: auto !important;
    }

    #marks-section .btn-logout:hover,
    #main-content .btn-logout:hover {
        background: #f8fafc !important;
    }

    /* Student marks table - styled like the image */
    #marks-section .marks-table,
    #marks-section .responsive-table,
    .marks-table-wrapper table {
        display: table !important;
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        border-radius: 1rem !important;
        overflow: hidden !important;
        table-layout: fixed !important;
    }

    /* Show headers on mobile with dark background */
    #marks-section .marks-table thead,
    #marks-section .responsive-table thead {
        display: table-header-group !important;
    }

    #marks-section .marks-table thead tr,
    #marks-section .responsive-table thead tr {
        background: #475569 !important;
        display: table-row !important;
    }

    #marks-section .marks-table thead th,
    #marks-section .responsive-table thead th {
        display: table-cell !important;
        padding: 1rem 0.5rem !important;
        text-align: center !important;
        font-weight: 700 !important;
        color: white !important;
        text-transform: uppercase !important;
        font-size: 0.75rem !important;
        letter-spacing: 0.05em !important;
        border: none !important;
        vertical-align: middle !important;
    }

    #marks-section .marks-table tbody,
    #marks-section .responsive-table tbody {
        display: table-row-group !important;
    }

    #marks-section .marks-table tbody tr,
    #marks-section .responsive-table tbody tr {
        display: table-row !important;
        border-bottom: 1px solid #e5e7eb !important;
    }

    /* All table cells must display as table-cell */
    #marks-section .marks-table td,
    #marks-section .responsive-table td {
        display: table-cell !important;
        vertical-align: middle !important;
        text-align: center !important;
        padding: 1rem 0.5rem !important;
    }

    /* Assessment cells - purple gradient background */
    #marks-section .marks-table td:first-child,
    #marks-section .responsive-table td:first-child {
        background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%) !important;
        color: white !important;
        font-weight: 600 !important;
        width: 60% !important;
    }

    /* Marks cells - white background */
    #marks-section .marks-table td:last-child,
    #marks-section .responsive-table td:last-child {
        background: white !important;
        color: #1e293b !important;
        font-weight: 700 !important;
        font-size: 1.1rem !important;
        width: 40% !important;
    }

    /* Total row styling */
    #marks-section .marks-table tbody tr:last-child td:first-child,
    #marks-section .responsive-table tbody tr:last-child td:first-child {
        background: white !important;
        color: #1e293b !important;
        font-weight: 700 !important;
    }

    #marks-section .marks-table tbody tr:last-child td:last-child,
    #marks-section .responsive-table tbody tr:last-child td:last-child {
        color: #6366f1 !important;
        font-size: 1.3rem !important;
    }

    /* Remove ::before pseudo-elements for this style */
    #marks-section .marks-table td::before,
    #marks-section .responsive-table td::before {
        content: none !important;
        display: none !important;
    }

    /* Wrapper must not interfere */
    .marks-table-wrapper {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
    }

    /* Results layout - stack on mobile */
    .results-layout,
    div[style*="display: flex"][style*="gap: 2rem"] {
        flex-direction: column !important;
        gap: 1.5rem !important;
    }

    /* Stat boxes - full width on mobile */
    .results-layout>div,
    div[style*="flex: 0 0 280px"] {
        flex: 1 1 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
    }

    /* Class average and rank cards */
    div[style*="Class Average"],
    div[style*="Your Rank"] {
        padding: 1.5rem 1rem !important;
    }

    div[style*="Class Average"] div[style*="font-size: 3rem"],
    div[style*="Your Rank"] div[style*="font-size: 3rem"] {
        font-size: 2.5rem !important;
    }

    /* ========================================
       TABLE FIXES - Grid-Based Layout
       ======================================== */

    .responsive-table td,
    #stats-table td,
    table.responsive-table td,
    table[class*="responsive"] td {
        display: grid !important;
        grid-template-columns: 40% 60% !important;
        gap: 0.5rem !important;
        align-items: center !important;
        padding: 0.75rem 1rem !important;
        border-bottom: 1px solid #f1f5f9 !important;
        font-size: 0.95rem !important;
        min-height: 44px !important;
        box-sizing: border-box !important;
        text-align: left !important;
    }

    .responsive-table td::before,
    #stats-table td::before,
    table.responsive-table td::before,
    table[class*="responsive"] td::before {
        content: attr(data-label) !important;
        font-weight: 700 !important;
        color: #475569 !important;
        text-transform: uppercase !important;
        font-size: 0.75rem !important;
        letter-spacing: 0.05em !important;
        text-align: left !important;
        grid-column: 1 !important;
        word-wrap: break-word !important;
        float: none !important;
        padding-right: 0 !important;
    }

    /* Hide table headers on mobile */
    .responsive-table thead,
    #stats-table thead,
    table.responsive-table thead {
        display: none !important;
    }

    /* Make tbody display as block */
    .responsive-table tbody,
    #stats-table tbody,
    table.responsive-table tbody {
        display: block !important;
    }

    /* Make each row a card */
    .responsive-table tbody tr,
    #stats-table tbody tr,
    table.responsive-table tbody tr {
        display: block !important;
        margin-bottom: 1.25rem !important;
        background: white !important;
        border: 1px solid #e2e8f0 !important;
        border-radius: 0.75rem !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
        overflow: hidden !important;
        padding: 0.5rem !important;
    }

    /* Remove any clearfix that might interfere */
    .responsive-table td::after,
    #stats-table td::after {
        content: none !important;
        display: none !important;
    }

    /* Ensure table wrappers allow horizontal scroll */
    .marks-table-wrapper,
    .table-wrapper,
    #stats-table-container,
    div[style*="overflow"] {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
        width: 100% !important;
        max-width: 100% !important;
    }

    /* Remove min-width from table headers and cells */
    #stats-table th,
    #stats-table td,
    .responsive-table th,
    .responsive-table td {
        min-width: 0 !important;
        max-width: 100% !important;
    }

    /* ========================================
       CHART FIXES
       ======================================== */

    #performance-chart,
    #bell-curve-container,
    .chart-container,
    canvas,
    svg {
        width: 100% !important;
        max-width: 100% !important;
        height: auto !important;
        min-height: 200px !important;
        overflow: visible !important;
    }

    #performance-chart canvas,
    #bell-curve-container svg,
    .chart-container canvas,
    .chart-container svg {
        width: 100% !important;
        height: auto !important;
        max-width: 100% !important;
    }

    /* Fix Chart.js responsive sizing */
    canvas {
        max-height: 300px !important;
    }

    /* ========================================
       HEADER & TAB FIXES
       ======================================== */

    /* Flexible headers */
    .header-row,
    .page-header,
    .admin-header,
    nav,
    .nav-tabs {
        flex-direction: column !important;
        gap: 1rem !important;
        padding: 1rem !important;
        width: 100% !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
    }

    /* Wrap tabs properly */
    .tabs,
    .nav-tabs,
    .tab-container,
    nav[role="tablist"] {
        flex-wrap: wrap !important;
        gap: 0.5rem !important;
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
    }

    .tab-btn,
    .nav-link,
    button[role="tab"] {
        flex: 1 1 45% !important;
        min-width: 100px !important;
        max-width: 48% !important;
        text-align: center !important;
        white-space: normal !important;
        word-wrap: break-word !important;
        font-size: 0.85rem !important;
        padding: 0.75rem 0.5rem !important;
    }

    /* ========================================
       CARD & CONTAINER FIXES
       ======================================== */

    .card {
        max-width: 100% !important;
        padding: 1.5rem !important;
        margin: 0.5rem !important;
    }

    /* Stats cards should stack */
    .stats-grid,
    .card-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
    }

    /* ========================================
       TEXT & OVERFLOW FIXES
       ======================================== */

    /* Prevent text overflow */
    td,
    th,
    div,
    p,
    span,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: normal !important;
    }

    /* Specific fixes for table cells */
    table td,
    table th {
        min-width: 80px !important;
        max-width: 100% !important;
    }

    /* ========================================
       BUTTON & INPUT FIXES
       ======================================== */

    .btn-primary,
    .btn-secondary,
    button,
    select,
    input {
        min-height: 48px !important;
        font-size: 16px !important;
        width: 100% !important;
        max-width: 100% !important;
    }

    /* ========================================
       IMAGE FIXES
       ======================================== */

    img {
        max-width: 100% !important;
        height: auto !important;
    }
}